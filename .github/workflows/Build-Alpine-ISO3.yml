name: Build-Alpine-ISO3

on:
  workflow_dispatch:
  push:
    branches: [ main ]
    paths:
      - 'scripts/docker-build3.sh'
      - '.github/workflows/Build-Alpine-ISO3.yml'

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        persist-credentials: false
        
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          grub2-common \
          grub-pc-bin \
          grub-efi-amd64-bin \
          xorriso \
          mtools \
          dosfstools \
          wget
        
    - name: Make script executable
      run: |
        chmod +x scripts/docker-build3.sh
        
    - name: Build ISO
      run: |
        cd scripts
        ./docker-build3.sh
        
    - name: Upload ISO artifact
      uses: actions/upload-artifact@v4
      with:
        name: minimal-live-iso
        path: |
          minimal-live-*.iso
        retention-days: 7
        
    - name: Display build info
      run: |
        echo "=== 构建完成 ==="
        echo "生成的ISO文件:"
        ls -lh minimal-live-*.iso
        echo ""
        echo "文件详细信息:"
        file minimal-live-*.iso
