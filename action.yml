name: "Build OpenWRT Installer alpine-iso"
author: "sirpdboy"
description: "Convert OpenWRT IMG to bootable auto-installer ISO"
branding:
  icon: 'package'
  color: 'green'

inputs:
  INPUT_IMG:
    description: "Path to OpenWRT IMG file"
    required: false
    default: "/mnt/openwrt.img"
  OUTPUT_DIR:
    description: "Output directory for ISO file"
    required: false
    default: "/output"
  OUTPUT_ISO_NAME:
    description: "Name of output ISO file"
    required: false
    default: "openwrt-alpine-iso.iso"

runs:
  using: "composite"
  steps:
    - name: Checkout action repository files
      shell: bash
      run: |
        echo "Copying required scripts..."
        if [ -f "${{ github.action_path }}/docker-build.sh" ]; then
          cp "${{ github.action_path }}/docker-build.sh" ./dockerrun.sh
          chmod +x ./dockerrun.sh
        fi
        if [ -f "${{ github.action_path }}/build-openwrt-alpine-iso.sh" ]; then
          cp "${{ github.action_path }}/build-openwrt-alpine-iso.sh" ./build.sh
          chmod +x ./build.sh
        fi
        
    - name: Setup
      shell: bash
      run: |
        echo "üöÄ OpenWRT ISO Builder"
        echo "======================"
        echo "Input IMG: ${{ inputs.INPUT_IMG }}"
        echo "Output Dir: ${{ inputs.OUTPUT_DIR }}"
        echo "ISO Name: ${{ inputs.OUTPUT_ISO_NAME }}"
        echo ""
        # ls -la ./
    - name: Run Docker Build
      shell: bash
      run: |
        if [ ! -f "./dockerrun.sh" ]; then
          echo "‚ùå dockerrun.sh not found!"
          echo "Current directory contents:"
          ls -la
          exit 1
        fi
        
        # ÊâßË°åDockerÊûÑÂª∫
        ./dockerrun.sh \
          "${{ inputs.INPUT_IMG }}" \
          "${{ inputs.OUTPUT_DIR }}" \
          "${{ inputs.OUTPUT_ISO_NAME }}"
