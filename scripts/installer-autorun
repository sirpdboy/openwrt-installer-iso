#!/bin/sh
### BEGIN INIT INFO
# Provides:          installer-autorun
# Required-Start:    $local_fs $network $named $time $syslog
# Required-Stop:     $local_fs $network $named $time $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Description:       OpenWRT Installer Auto-run
### END INIT INFO

case "$1" in
    start)
        # 检查是否在live环境中
        if [ -d /live ]; then
            # 等待控制台就绪
            sleep 3
            
            # 检查是否已经安装过
            if [ ! -f /tmp/installer-run ]; then
                touch /tmp/installer-run
                /usr/local/bin/install-openwrt.sh
            fi
        fi
        ;;
    stop)
        ;;
    *)
        echo "Usage: $0 {start|stop}"
        exit 1
        ;;
esac

exit 0
